---
title: "Untitled"
author: "Tony Zong"
date: '2022-09-04'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
cols <- c(
          # response
          'Y', 
          
          # treatment
          'W',
          
          # covariates
          'male', 
          'age', 'age_flag', 'age_check_flag',
          'ed', 'ed_flag', 
          'urban', 
          'rel_none', 'rel_christian', 'rel_muslim', 'rel_traditionalist', 'rel_other', 
          'denom_pentecostal', 
          'religiosity', 'religiosity_flag',
          'god',
          'locus', 'locus_flag',
          'science', 'science_flag',
          'dli',
          'fb_post', 'fb_post_flag',
          'fb_msg', 'fb_msg_flag',
          'crt',
          'hhi', 'hhi_flag',
          'cash',
          'hh', 'hh_flag',
          'pol',
          'cov_concern', 'cov_concern_flag',
          'cov_info',
          'cov_efficacy', 'cov_efficacy_flag',
          'strat_send_false0', 'strat_send_false1', 'strat_send_false2', 
          'strat_send_true0', 'strat_send_true1', 'strat_send_true2', 
          'strat_timeline_false0', 'strat_timeline_false1', 'strat_timeline_false2', 
          'strat_timeline_true0', 'strat_timeline_true1', 'strat_timeline_true2',
          'nigeria', # is this also considered as a covariate?
          
          ### deleted - stimuli indicators
          #'stimf1', 'stimf2', 'stimf3', 'stimf4', 'stimf5', 'stimf6', 'stimf7', 'stimf8', 'stimf9', 'stimf10', 'stimf11', 'stimf12', 'stimf13',
          #'stimf14', 'stimf15', 'stimf16',
          #'stimt1', 'stimt2', 'stimt3', 'stimt4', 'stimt5', 'stimt6',
          #'stimb1', 'stimb2', 'stimb3', 'stimb4', 'stimb5',
          
          ### Response to pre-treatment stimuli
          'pre_false',
          'pre_true',
          
          ### Response to post-treatment stimuli
          'attrited',
          # Newly added:
          'post_true',
          'post_false',
          'post_true_any',
          'post_false_any',
          
          # Additional response measures
          'pre_true_any',
          'pre_false_any',
          'post_true_timeline',
          'post_true_send',
          'post_true_seen',
          'post_false_timeline',
          'post_false_send',
          'post_false_seen',
          'post_true_prop',
          'post_true_timeline_prop',
          'post_true_send_prop',
          'post_false_prop',
          'post_false_timeline_prop',
          'post_false_send_prop',
          
          # exclude these
          #'dv_timeline_pre1', 'dv_timeline_pre2', 'dv_timeline_pre3', 'dv_timeline_pre4',
          #'dv_timeline_post5', 'dv_timeline_post6', 'dv_timeline_post7', 'dv_timeline_post8',
          #'dv_send_pre1', 'dv_send_pre2', 'dv_send_pre3', 'dv_send_pre4',
          #'dv_send_post5', 'dv_send_post6', 'dv_send_post7', 'dv_send_post8',
          
          
          'batch', 'optimal'
          
          )
```


Variables that need description:

          'Y', 
          'W',
          'age_flag',
          'batch',
          'optimal',
          
          Newly added:
          'post_true',
          'post_false',
          'post_true_any',
          'post_false_any',
          'pre_true_any',
          'pre_false_any',
          'post_true_timeline',
          'post_true_send',
          'post_true_seen',
          'post_false_timeline',
          'post_false_send',
          'post_false_seen',
          'post_true_prop',
          'post_true_timeline_prop',
          'post_true_send_prop',
          'post_false_prop',
          'post_false_timeline_prop',
          'post_false_send_prop',
          
          
Variables to exclude:

          'god',
          'cov_info',
          
          - stimuli indicators
          'stimf1', 'stimf2', 'stimf3', 'stimf4', 'stimf5', 'stimf6', 'stimf7', 'stimf8', 'stimf9', 'stimf10', 'stimf11', 'stimf12', 'stimf13',
          'stimf14', 'stimf15', 'stimf16',
          'stimt1', 'stimt2', 'stimt3', 'stimt4', 'stimt5', 'stimt6',
          'stimb1', 'stimb2', 'stimb3', 'stimb4', 'stimb5',
          
          - `last_response`:
          'dv_timeline_pre1', 'dv_timeline_pre2', 'dv_timeline_pre3', 'dv_timeline_pre4',
          'dv_timeline_post5', 'dv_timeline_post6', 'dv_timeline_post7', 'dv_timeline_post8',
          'dv_send_pre1', 'dv_send_pre2', 'dv_send_pre3', 'dv_send_pre4',
          'dv_send_post5', 'dv_send_post6', 'dv_send_post7', 'dv_send_post8',
          
```{r}
attr(df_treat$Y, 'shortDescription') <- "Response; response function: Y = - post_false + 0.5 * post_true."

attr(df_treat$W, 'shortDescription') <- "Treatment each subject receives. There are 40 unqiue levels."

attr(df_treat$age_flag, 'shortDescription') <- "Pre-treatment covariate: binary coded as 1 if age >= 120 (i.e. abnormal age) or empty, 0 otherwise."

attr(df_treat$batch, 'shortDescription') <- "The batch in the linear Thompson sampling algorithm; integer ranging from 1 to 5."

attr(df_treat$optimal, 'shortDescription') <- ""

attr(df_treat$post_true, "shortDescription") <- "Post-treatment true stimuli response count: record how many times the respondent wants to share any of the post-treatment true stimuli; integer coded between 0 and 4; note that for each stimulus, the respondent can share at most twice (once on timeline, once on messenger); there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_false, "shortDescription") <- "Post-treatment false stimuli response count: record how many times the respondent wants to share any of the post-treatment false stimuli; integer coded between 0 and 4; note that for each stimulus, the respondent can share at most twice (once on timeline, once on messenger); there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_true_any, "shortDescription") <- "Post-treatment true stimuli response count (# stimuli): record how many post-treatment true stimuli the respondent wants to share; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_false_any, "shortDescription") <- "Post-treatment false stimuli response count (# stimuli): record how many post-treatment false stimuli the respondent wants to share; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$pre_true_any, "shortDescription") <- "Pre-treatment true stimuli response count (# stimuli): record how many pre-treatment true stimuli the respondent wants to share; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli pre-treatment."

attr(df_treat$pre_false_any, "shortDescription") <- "Pre-treatment false stimuli response count (# stimuli): record how many pre-treatment false stimuli the respondent wants to share; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli pre-treatment."

attr(df_treat$post_true_timeline, "shortDescription") <- "Post-treatment true stimuli response count (# timeline): record how many post-treatment true stimuli the respondent wants to share in facebook timeline; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_true_send, "shortDescription") <- "Post-treatment true stimuli response count (# send): record how many post-treatment true stimuli the respondent wants to share via facebook message; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_true_seen, "shortDescription") <- "Post-treatment true stimuli seen (count): record how many post-treatment true stimuli the respondent sees; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_false_timeline, "shortDescription") <- "Post-treatment false stimuli response count (# timeline): record how many post-treatment false stimuli the respondent wants to share in facebook timeline; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_false_send, "shortDescription") <- "Post-treatment false stimuli response count (# send): record how many post-treatment false stimuli the respondent wants to share via facebook message; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_false_seen, "shortDescription") <- "Post-treatment false stimuli seen (count): record how many post-treatment false stimuli the respondent sees; integer coded between 0 and 2; note that there are two true stimuli and two false stimuli post-treatment."

attr(df_treat$post_true_prop, "shortDescription") <- "Post-treatment true stimuli response proportion: record the proportion of post-treatment true stimuli the respondent wants to share among all the post-treatment true stimuli they've seen (post_true_any/post_true_seen); float between 0 and 1."

attr(df_treat$post_true_timeline_prop, "shortDescription") <- "Post-treatment true stimuli response proportion (timeline): record the proportion of post-treatment true stimuli the respondent wants to share in facebook timeline among all the post-treatment true stimuli they've seen (post_true_timeline/post_true_seen); float between 0 and 1."

attr(df_treat$post_true_send_prop, "shortDescription") <- "Post-treatment true stimuli response proportion (message): record the proportion of post-treatment true stimuli the respondent wants to share via facebook message among all the post-treatment true stimuli they've seen (post_true_timeline/post_true_seen); float between 0 and 1."

attr(df_treat$post_false_prop, "shortDescription") <- "Post-treatment false stimuli response proportion: record the proportion of post-treatment false stimuli the respondent wants to share among all the post-treatment false stimuli they've seen (post_false_any/post_false_seen); float between 0 and 1."

attr(df_treat$post_false_timeline_prop, "shortDescription") <- "Post-treatment false stimuli response proportion (timeline): record the proportion of post-treatment false stimuli the respondent wants to share in facebook timeline among all the post-treatment false stimuli they've seen (post_false_timeline/post_false_seen); float between 0 and 1."

attr(df_treat$post_false_send_prop, "shortDescription") <- "Post-treatment false stimuli response proportion (message): record the proportion of post-treatment false stimuli the respondent wants to share via facebook message among all the post-treatment false stimuli they've seen (post_true_timeline/post_true_seen); float between 0 and 1."
```


---
newly added:

```{r}
unique((
df %>% 
  mutate(true_any = post_true_any + pre_true_any) %>% 
  
  mutate(share_TB1 = coalesce(share_TB1, 0)) %>% 
  mutate(share_TB2 = coalesce(share_TB2, 0)) %>% 
  mutate(share_TB3 = coalesce(share_TB3, 0)) %>% 
  mutate(share_TB4 = coalesce(share_TB4, 0)) %>% 
  mutate(share_TB5 = coalesce(share_TB5, 0)) %>% 
  
  mutate(share_TK1 = coalesce(share_TK1, 0)) %>% 
  mutate(share_TK2 = coalesce(share_TK2, 0)) %>% 
  mutate(share_TK3 = coalesce(share_TK3, 0)) %>% 
  mutate(share_TK4 = coalesce(share_TK4, 0)) %>% 
  mutate(share_TK5 = coalesce(share_TK5, 0)) %>% 
  mutate(share_TK6 = coalesce(share_TK6, 0)) %>% 
  
  mutate(share_TN1 = coalesce(share_TN1, 0)) %>% 
  mutate(share_TN2 = coalesce(share_TN2, 0)) %>% 
  mutate(share_TN3 = coalesce(share_TN3, 0)) %>% 
  mutate(share_TN4 = coalesce(share_TN4, 0)) %>% 
  mutate(share_TN6 = coalesce(share_TN6, 0)) %>% 

  mutate(true_shared = share_TB1 + share_TB2 + share_TB3 + share_TB4 + share_TB5 +
                       share_TK1 + share_TK2 + share_TK3 + share_TK4 + share_TK5 + share_TK6 +
                       share_TN1 + share_TN2 + share_TN3 + share_TN4 + share_TN6) %>% 
  
  mutate(true_click_through_rate = coalesce(true_shared / true_any, 0)) %>% 
  
  
  # should this be the denominator?
  mutate(false_any = post_false_any + pre_false_any) %>% 
  
  mutate(link_FK2 = coalesce(link_FK2, 0)) %>% 
  mutate(link_FK3 = coalesce(link_FK3, 0)) %>% 
  mutate(link_FK4 = coalesce(link_FK4, 0)) %>% 
  mutate(link_FK5 = coalesce(link_FK5, 0)) %>% 
  mutate(link_FK6 = coalesce(link_FK6, 0)) %>% 
  mutate(link_FK7 = coalesce(link_FK7, 0)) %>% 
  mutate(link_FK8 = coalesce(link_FK8, 0)) %>% 
  mutate(link_FK9 = coalesce(link_FK9, 0)) %>% 
  mutate(link_FK10 = coalesce(link_FK10, 0)) %>% 
  mutate(link_FK11 = coalesce(link_FK11, 0)) %>% 
  mutate(link_FK12 = coalesce(link_FK12, 0)) %>% 
  mutate(link_FK13 = coalesce(link_FK13, 0)) %>% 
  
  mutate(link_FN1 = coalesce(link_FN1, 0)) %>% 
  mutate(link_FN2 = coalesce(link_FN2, 0)) %>% 
  mutate(link_FN3 = coalesce(link_FN3, 0)) %>% 
  mutate(link_FN4 = coalesce(link_FN4, 0)) %>% 
  mutate(link_FN5 = coalesce(link_FN5, 0)) %>% 
  mutate(link_FN6 = coalesce(link_FN6, 0)) %>% 
  mutate(link_FN7 = coalesce(link_FN7, 0)) %>% 
  mutate(link_FN8 = coalesce(link_FN8, 0)) %>% 
  mutate(link_FN9 = coalesce(link_FN9, 0)) %>% 
  mutate(link_FN10 = coalesce(link_FN10, 0)) %>% 
  mutate(link_FN11 = coalesce(link_FN11, 0)) %>% 
  mutate(link_FN12 = coalesce(link_FN12, 0)) %>% 
  mutate(link_FN13 = coalesce(link_FN13, 0)) %>% 
  mutate(link_FN14 = coalesce(link_FN14, 0)) %>% 
  mutate(link_FN15 = coalesce(link_FN15, 0)) %>% 
  mutate(link_FN16 = coalesce(link_FN16, 0)) %>% 
  
  mutate(false_clicked = link_FK2 + link_FK3 + link_FK4 + link_FK5 + link_FK6 + link_FK7 +
                       link_FK8 + link_FK9 + link_FK10 + link_FK11 + link_FK12 + link_FK13 +
                       link_FN1 + link_FN2 + link_FN3 + link_FN4 + link_FN5 + link_FN6 +
                       link_FN7 + link_FN8 + link_FN9 + link_FN10 + link_FN11 + link_FN12 +
                       link_FN13 + link_FN14 + link_FN15 + link_FN16) %>% 
  
  mutate(false_click_through_rate = coalesce(false_clicked / false_any, 0))

)$false_click_through_rate)
```




